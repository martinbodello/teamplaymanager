@using System.Web.Mvc
@using System.Web.Mvc.Html
@using System.Web.Optimization
@using TPM.Models
@using TPM.Models.ViewModel
@model TPM.Models.Jugador

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="panel panel-primary">
    <div class="panel-heading">
        Crear Jugador
      <div class="pull-right">
          <a class="link-panel" href="@ViewBag.returnUrl">
              <img src="~/Images/boton_volver.png" />
              Volver
          </a>
      </div>
    </div>
    <div class="panel-body">
        @using (Html.BeginForm("Create", "Jugador", FormMethod.Post, new { enctype = "multipart/form-data" }))
        {       
            <input type="hidden" name="returnUrl" value="@ViewBag.returnUrl" />
            
            @Html.ValidationSummary(true)
          
            <fieldset>
                <legend>Jugador</legend>

                <table width="100%">
                    <tr>
                        <td valign="top" colspan="2">
                            <table width="100%">
                                <tr>
                                    <td>
                                        @Html.Label("Foto Jugador:")
                                    </td>
                                    <td style="text-align: center">
                                        <div id='botonera'>
                                            <input type="file" name="file" id="file" accept="image/*"></input>
                                            <input id="cancelar" type="button" value="Cancelar"></input>
                                        </div>
                                    </td>
                                    <td style="text-align: right">
                                        <img id="vistaPrevia" src="" alt="" />
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
                <div class="well">
                    <div class="titleDatos"><span class="label label-default">Datos Personales</span></div>
                    <table class="tablaCreate" width="100%">
                        <tr>
                            <td class="primerColumna">
                                @Html.Label("Nombre:")
                            </td>
                            <td>
                                @Html.EditorFor(model => model.Nombre)
                                @Html.ValidationMessage("Nombre", "Por favor, ingrese el nombre")
                            </td>
                        </tr>
                        <tr>
                            <td class="primerColumna">
                                 @Html.Label("Apellido:")
                            </td>
                            <td>
                                @Html.EditorFor(model => model.Apellido)
                                @Html.ValidationMessageFor(model => model.Apellido, "Por favor, ingrese el apellido")
                            </td>
                        </tr>
                        <tr>
                            <td class="primerColumna">
                                @Html.Label("Apodo:")
                            </td>
                            <td>
                                @Html.TextBoxFor(model => model.Apodo)
                            </td>
                        </tr>
                        <tr>
                            <td class="primerColumna">
                                @Html.Label("Tipo De Documento:")
                            </td>
                            <td>
                                @Html.DropDownListFor(model => model.TipoDocId, new SelectList(Model.TipoDocLista, "TipoDocId", "TipoDocNombre", 1))
                            </td>
                        </tr>
                        <tr>
                            <td class="primerColumna">
                                @Html.Label("Numero De Documento:")
                            </td>
                            <td>
                                @Html.TextBoxFor(model => model.NumeroDoc)
                                @Html.ValidationMessageFor(model => model.NumeroDoc, "Por favor, ingrese el número de documento")
                            </td>
                        </tr>
                        <tr>
                            <td class="primerColumna">
                                @Html.Label("Fecha de Nacimiento:")
                            </td>
                            <td>
                                @Html.TextBoxFor(model => model.FechaNacFormateada)
                                @Html.ValidationMessageFor(model => model.FechaNacFormateada, "Por favor, ingrese la fecha de nacimiento")
                            </td>
                        </tr>
                        <script>
                            $('#FechaNacFormateada').datepicker({
                                format: "dd/mm/yyyy",
                                language: "es",
                                autoclose: true,
                                startView: 2
                            });
                        </script>
                        <tr>
                            <td class="primerColumna">
                                @Html.Label("Domicilio de residencia:")
                            </td>
                            <td>
                                @Html.EditorFor(model => model.Domicilio)
                                @Html.ValidationMessageFor(model => model.Domicilio, "Por favor, ingrese el domicilio")
                            </td>
                        </tr>
                        <tr>
                            <td class="primerColumna">
                                @Html.Label("Localidad de residencia:")
                            </td>
                            <td>
                                @Html.DropDownListFor(model => model.LocalidadId, new SelectList(Model.LocalidadLista, "LocalidadId", "LocalidadNombre"))
                            </td>
                        </tr>
                        <tr>
                            <td class="primerColumna">
                                @Html.Label("Peso:")
                            </td>
                            <td>
                                @Html.TextBoxFor(model => model.Peso)
                            </td>
                        </tr>
                        <tr>
                            <td class="primerColumna">
                                @Html.Label("Estatura:")
                            </td>
                            <td>
                                @Html.TextBoxFor(model => model.Estatura)
                            </td>
                        </tr>
                         <tr>
                            <td class="primerColumna">
                                @Html.Label("Colegio:")
                            </td>
                            <td>
                                @Html.TextBoxFor(model => model.Colegio)
                            </td>
                        </tr>
                        <tr>
                            <td class="primerColumna">
                                @Html.Label("Teléfono:")
                            </td>
                            <td>
                                @Html.TextBoxFor(model => model.Telefono)
                            </td>
                        </tr>
                        <tr>
                            <td class="primerColumna">
                                @Html.Label("E-mail:")
                            </td>
                            <td>
                                @Html.TextBoxFor(model => model.Email)
                            </td>
                        </tr>
                        <tr>
                            <td class="primerColumna">
                                @Html.Label("Tiene ciudadania europea:")
                            </td>
                            <td>
                                @*@Html.TextBoxFor(model => model.CiudadaniaEuropea)*@
                                <select name="CiudadaniaEuropea" id="CiudadaniaEuropea">
                                    <option value="S">Si</option>
                                    <option value="N">No</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td class="primerColumna">
                                @Html.Label("Representante:")
                            </td>
                            <td>
                                @*@Html.TextBoxFor(model => model.Representante)*@
                                <select name="Representante" id="Representante">
                                    <option value="S">Si</option>
                                    <option value="N">No</option>
                                </select>
                            </td>
                        </tr>
                    </table>
                </div>
                <br />
                <div class="well">
                    <div class="titleDatos"><span class="label label-default">Cobertura Médica</span></div>
                     <table class="tablaCreate" width="100%">
                        <tr>
                            <td class="primerColumna">
                                @Html.Label("Obra Social:")
                            </td>
                            <td>
                                @Html.EditorFor(model => model.CoberturaMedica.ObraSocial)
                            </td>
                        </tr>
                         <tr>
                            <td class="primerColumna">
                                @Html.Label("Número de afiliado:")
                            </td>
                            <td>
                                @Html.EditorFor(model => model.CoberturaMedica.NroObraSocial)
                            </td>
                        </tr>
                         <tr>
                            <td class="primerColumna">
                                @Html.Label("Servicio de emergencia:")
                            </td>
                            <td>
                                @Html.EditorFor(model => model.CoberturaMedica.ServicioEmergencia)
                            </td>
                        </tr>
                         <tr>
                            <td class="primerColumna">
                                @Html.Label("Número de afiliado:")
                            </td>
                            <td>
                                @Html.EditorFor(model => model.CoberturaMedica.NroServicioEmergencia)
                            </td>
                        </tr>
                         <tr>
                            <td class="primerColumna">
                                @Html.Label("Hospital:")
                            </td>
                            <td>
                                @Html.EditorFor(model => model.CoberturaMedica.Hospital)
                            </td>
                        </tr>
                         <tr>
                            <td class="primerColumna">
                                @Html.Label("Teléfono:")
                            </td>
                            <td>
                                @Html.EditorFor(model => model.CoberturaMedica.Telefono)
                            </td>
                        </tr>
                         <tr>
                            <td class="primerColumna">
                                @Html.Label("Medicamento:")
                            </td>
                            <td>
                                @Html.EditorFor(model => model.CoberturaMedica.Medicamente)
                            </td>
                        </tr>
                         <tr>
                            <td class="primerColumna">
                                @Html.Label("Alergico:")
                            </td>
                            <td>
                                @Html.EditorFor(model => model.CoberturaMedica.Alergico)
                            </td>
                        </tr>
                         <tr>
                            <td class="primerColumna">
                                @Html.Label("Observaciones:")
                            </td>
                            <td>
                                @Html.EditorFor(model => model.CoberturaMedica.Observaciones)
                            </td>
                        </tr>
                     </table>
                </div>
                <input class="btn btn-primary" type="submit" value="Crear" />
            </fieldset>
        }
    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script type="text/javascript">


        window.imagenVacia = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';

        window.mostrarVistaPrevia = function mostrarVistaPrevia() {

            var Archivos, Lector;

            //Para navegadores antiguos
            if (typeof FileReader !== "function") {
                jQuery('#infoNombre').text('[Vista previa no disponible]');
                jQuery('#infoTamaño').text('(su navegador no soporta vista previa!)');
                return;
            }

            Archivos = jQuery('#file')[0].files;
            if (Archivos.length > 0) {

                Lector = new FileReader();
                Lector.onloadend = function (e) {
                    var origen, tipo;

                    //Envia la imagen a la pantalla
                    origen = e.target; //objeto FileReader
                    //Prepara la información sobre la imagen
                    tipo = window.obtenerTipoMIME(origen.result.substring(0, 30));

                    jQuery('#infoNombre').text(Archivos[0].name);
                    jQuery('#infoTamaño').text('Tamaño: ' + e.total + ' bytes');
                    //Si el tipo de archivo es válido lo muestra, 
                    //sino muestra un mensaje 
                    if (tipo !== 'image/jpeg' && tipo !== 'image/png' && tipo !== 'image/gif') {
                        jQuery('#vistaPrevia').attr('src', window.imagenVacia);
                        alert('El formato de imagen no es válido: debe seleccionar una imagen JPG, PNG o GIF.');
                    } else {
                        jQuery('#vistaPrevia').attr('src', origen.result);
                        window.obtenerMedidas();
                    }

                };
                Lector.onerror = function (e) {
                    console.log(e)
                }
                Lector.readAsDataURL(Archivos[0]);

            } else {
                var objeto = jQuery('#file');
                objeto.replaceWith(objeto.val('').clone());
                jQuery('#vistaPrevia').attr('src', window.imagenVacia);
                jQuery('#infoNombre').text('[Seleccione una imagen]');
                jQuery('#infoTamaño').text('');
            };


        };

        //Lee el tipo MIME de la cabecera de la imagen
        window.obtenerTipoMIME = function obtenerTipoMIME(cabecera) {
            return cabecera.replace(/data:([^;]+).*/, '\$1');
        }

        //Obtiene las medidas de la imagen y las agrega a la 
        //etiqueta infoTamaño
        window.obtenerMedidas = function obtenerMedidas() {
            jQuery('<img/>').bind('load', function (e) {

                var tamaño = jQuery('#infoTamaño').text() + '; Medidas: ' + this.width + 'x' + this.height;

                jQuery('#infoTamaño').text(tamaño);

            }).attr('src', jQuery('#vistaPrevia').attr('src'));
        }

        jQuery(document).ready(function () {

            //Cargamos la imagen "vacía" que actuará como Placeholder
            jQuery('#vistaPrevia').attr('src', window.imagenVacia);

            //El input del archivo lo vigilamos con un "delegado"
            jQuery('#botonera').on('change', '#file', function (e) {
                window.mostrarVistaPrevia();
            });

            //El botón Cancelar lo vigilamos normalmente
            jQuery('#cancelar').on('click', function (e) {
                var objeto = jQuery('#file');
                objeto.replaceWith(objeto.val('').clone());

                jQuery('#vistaPrevia').attr('src', window.imagenVacia);
                jQuery('#infoNombre').text('[Seleccione una imagen]');
                jQuery('#infoTamaño').text('');
            });
        });



        $('#FechaNacFormateada').datepicker({
            format: "dd/mm/yy",
            language: "es"
        });
    </script>
}